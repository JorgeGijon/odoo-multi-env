version: "3.8"

#-----------------------------------------------------------------------------
# 🚀 Ejecutar en Stage (Ubuntu):
# docker-compose -f docker-compose.yml -f docker-compose.override.stage.yml up -d
#-----------------------------------------------------------------------------

services:
  # 🏗️ Odoo en modo Stage
  odoo:
    env_file:
      - .env.stage
    container_name: ${INSTANCE:-stage}-odoo
    ports:
      - "8070:8069"  # 📌 Puerto HTTP de Odoo para Stage
    environment:
      - ODOO_ENV=staging  # 🏗️ Define el entorno como Stage
    networks:
      - odoo-network

  # 🐘 PostgreSQL en Stage
  postgres:
    env_file:
      - .env.stage
    container_name: ${INSTANCE:-stage}-postgres

  # 🔴 Redis en Stage
  redis:
    env_file:
      - .env.stage
    container_name: ${INSTANCE:-stage}-redis

  # 🌍 Nginx en Stage
  nginx:
    container_name: ${INSTANCE:-stage}-nginx
    restart: always
    profiles:
      - "stage"
    volumes:
      - ./config/nginx-stage.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "80:80"  # 📌 Maneja tráfico HTTP para Stage
